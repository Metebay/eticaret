<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sepetim - PAFA TEAMSPORT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="./assets/PAFA TEAMSPORT LOGO.png" type="image/x-icon">
</head>
<body data-page-id="cart">

    <!-- Header Yükleme Alanı -->
    <div id="header-placeholder"></div>

    <main class="container mx-auto px-4 py-8 min-h-screen">
        <h1 class="text-4xl font-black text-gray-900 mb-8 text-center">Sepetim</h1>

        <div id="cart-container" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Sepet Ürünleri (Sol Taraf) -->
            <div id="cart-items-list" class="lg:col-span-2 space-y-6">
                <!-- Sepet buraya yüklenecek -->
            </div>

            <!-- Sipariş Özeti (Sağ Taraf) -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-xl p-6 sticky top-28 border border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6 border-b pb-4">Sipariş Özeti</h2>
                    
                    <div class="space-y-3 mb-6">
                        <div class="flex justify-between text-gray-700">
                            <span>Ara Toplam</span>
                            <span id="summary-subtotal">0.00 TL</span>
                        </div>
                        <div class="flex justify-between text-gray-700">
                            <span>Kargo</span>
                            <span class="font-medium text-emerald-600">Ücretsiz</span>
                        </div>
                    </div>

                    <div class="border-t pt-4">
                        <div class="flex justify-between text-2xl font-extrabold text-gray-900 mb-6">
                            <span>Toplam Tutar</span>
                            <span id="summary-total" class="text-emerald-600">0.00 TL</span>
                        </div>
                        
                        <a id="checkout-link" href="./checkout.html" class="block w-full text-center btn-primary text-white py-3 px-4 rounded-xl font-bold text-lg transition duration-150 shadow-md">
                            Siparişi Onayla
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mesaj Modalı -->
        <div id="message-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl p-8 shadow-2xl max-w-sm w-full">
                <h3 id="modal-title" class="text-2xl font-bold text-gray-900 mb-4"></h3>
                <p id="modal-message" class="text-gray-700 mb-6"></p>
                <button onclick="closeModal()" class="w-full bg-emerald-600 text-white py-3 rounded-lg hover:bg-emerald-700 transition duration-200 font-bold">Tamam</button>
            </div>
        </div>
    </main>

    <!-- Footer Yükleme Alanı -->
    <div id="footer-placeholder"></div>

    <script type="module">
        import { 
            loadHeaderAndFooter,
            initAuthAndNav, 
            getCart, 
            getCartTotalPrice,
            updateCartQuantity,
            removeFromCart
        } from './common.js';

        document.addEventListener('DOMContentLoaded', async () => {
            await loadHeaderAndFooter('cart');
            loadCartPage();
        });

        function loadCartPage() {
            const cart = getCart();
            const cartItemsList = document.getElementById('cart-items-list');
            
            if (cart.length === 0) {
                cartItemsList.innerHTML = `
                    <div class="bg-white p-8 rounded-lg shadow-md text-center col-span-full">
                        <p class="text-gray-600 text-lg mb-6">Sepetinizde henüz ürün bulunmamaktadır.</p>
                        <a href="./products.html" class="btn-primary text-white py-2 px-6 rounded-lg transition duration-200 font-semibold">
                            Alışverişe Başla
                        </a>
                    </div>
                `;
                updateSummary(0);
                document.getElementById('checkout-link').classList.add('opacity-50', 'pointer-events-none');
                return;
            }

            cartItemsList.innerHTML = '';
            document.getElementById('checkout-link').classList.remove('opacity-50', 'pointer-events-none');

            cart.forEach(item => {
                const price = (item.price || 0);
                const discount = (item.discount || 0);
                const discountedPrice = price * (1 - (discount / 100));
                
                const itemHtml = `
                    <div class="bg-white rounded-xl shadow-lg p-4 flex flex-col md:flex-row items-center gap-4 border border-gray-200">
                        <img src="${item.images[0] || 'https://placehold.co/100x100'}" alt="${item.name}" class="w-24 h-24 object-cover rounded-lg border">
                        
                        <div class="flex-1 text-center md:text-left">
                            <h3 class="text-xl font-bold text-gray-900">${item.name}</h3>
                            <p class="text-gray-600 text-sm capitalize">${item.category}</p>
                        </div>

                        <div class="flex items-center gap-3">
                            <label for="qty-${item.id}" class="text-sm font-medium">Adet:</label>
                            <input type="number" id="qty-${item.id}" value="${item.quantity}" min="1" 
                                   class="w-16 p-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                   data-product-id="${item.id}">
                        </div>

                        <div class="text-lg font-bold text-emerald-600 text-center md:text-right w-32">
                            ${(discountedPrice * item.quantity).toFixed(2)} TL
                        </div>

                        <button class="text-red-500 hover:text-red-700 remove-btn" data-product-id="${item.id}">
                            <i class="fas fa-trash-alt text-lg"></i>
                        </button>
                    </div>
                `;
                cartItemsList.innerHTML += itemHtml;
            });

            const totalPrice = getCartTotalPrice();
            updateSummary(totalPrice);
            setupCartListeners();
        }

        function updateSummary(totalPrice) {
            document.getElementById('summary-subtotal').textContent = `${totalPrice.toFixed(2)} TL`;
            document.getElementById('summary-total').textContent = `${totalPrice.toFixed(2)} TL`;
        }

        function setupCartListeners() {
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('change', (e) => {
                    const productId = e.target.dataset.productId;
                    const quantity = parseInt(e.target.value);
                    if (quantity >= 0) {
                        updateCartQuantity(productId, quantity);
                        loadCartPage();
                    }
                });
            });

            document.querySelectorAll('.remove-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = e.currentTarget.dataset.productId;
                    removeFromCart(productId);
                    loadCartPage();
                });
            });
        }
    </script>
</body>
</html>
