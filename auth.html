<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giriş Yap / Kayıt Ol - PAFA TEAMSPORT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="./assets/PAFA TEAMSPORT LOGO.png" type="image/x-icon">
</head>
<body data-page-id="auth">

    <!-- Header Yükleme Alanı -->
    <div id="header-placeholder"></div>

    <main class="container mx-auto px-4 py-12 flex justify-center items-center min-h-[70vh]">
        <div class="w-full max-w-md bg-white p-8 rounded-xl shadow-2xl border border-gray-200">
            
            <!-- Sekme Başlıkları -->
            <div class="flex border-b border-gray-200 mb-6">
                <button id="tab-login" class="flex-1 py-3 text-lg font-bold border-b-2 border-emerald-600 text-emerald-600">Giriş Yap</button>
                <button id="tab-register" class="flex-1 py-3 text-lg font-bold border-b-2 border-transparent text-gray-500 hover:text-gray-700">Kayıt Ol</button>
            </div>

            <!-- Giriş Formu -->
            <div id="form-login">
                <form id="login-form">
                    <div class="mb-6">
                        <label for="login-email" class="block text-sm font-semibold text-gray-700 mb-2">Email Adresi</label>
                        <input type="email" id="login-email" required class="mt-1 block w-full px-4 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="ornek@mail.com">
                    </div>
                    <div class="mb-8">
                        <label for="login-password" class="block text-sm font-semibold text-gray-700 mb-2">Şifre</label>
                        <input type="password" id="login-password" required class="mt-1 block w-full px-4 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="******">
                    </div>
                    <button type="submit" class="w-full btn-primary text-white py-3 px-4 rounded-xl font-bold text-lg transition duration-150 shadow-md">Giriş Yap</button>
                    <p id="login-error" class="text-red-500 text-sm mt-4 text-center font-medium"></p>
                </form>
            </div>

            <!-- Kayıt Formu (Gizli) -->
            <div id="form-register" class="hidden">
                <form id="register-form">
                    <div class="mb-4">
                        <label for="register-name" class="block text-sm font-semibold text-gray-700 mb-2">Ad Soyad</label>
                        <input type="text" id="register-name" required class="mt-1 block w-full px-4 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="Adınız Soyadınız">
                    </div>
                    <div class="mb-4">
                        <label for="register-email" class="block text-sm font-semibold text-gray-700 mb-2">Email Adresi</label>
                        <input type="email" id="register-email" required class="mt-1 block w-full px-4 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="ornek@mail.com">
                    </div>
                    <div class="mb-8">
                        <label for="register-password" class="block text-sm font-semibold text-gray-700 mb-2">Şifre (Min 6 Karakter)</label>
                        <input type="password" id="register-password" required class="mt-1 block w-full px-4 py-2.5 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-500" placeholder="******">
                    </div>
                    <button type="submit" class="w-full btn-primary text-white py-3 px-4 rounded-xl font-bold text-lg transition duration-150 shadow-md">Kayıt Ol</button>
                    <p id="register-error" class="text-red-500 text-sm mt-4 text-center font-medium"></p>
                </form>
            </div>
        </div>
    </main>
    
    <!-- Footer Yükleme Alanı -->
    <div id="footer-placeholder"></div>

    <!-- Mesaj Modalı -->
    <div id="message-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl p-8 shadow-2xl max-w-sm w-full">
            <h3 id="modal-title" class="text-2xl font-bold text-gray-900 mb-4"></h3>
            <p id="modal-message" class="text-gray-700 mb-6"></p>
            <button onclick="closeModal()" class="w-full bg-emerald-600 text-white py-3 rounded-lg hover:bg-emerald-700 transition duration-200 font-bold">Tamam</button>
        </div>
    </div>

    <!-- JavaScript Mantığı -->
    <script type="module">
        import { 
            loadHeaderAndFooter,
            initAuthAndNav, 
            signInUser,
            registerUser, 
            showModal
        } from './common.js';

        document.addEventListener('DOMContentLoaded', async () => {
            await loadHeaderAndFooter('auth');
            setupTabs();
            setupForms();
        });

        function setupTabs() {
            const tabLogin = document.getElementById('tab-login');
            const tabRegister = document.getElementById('tab-register');
            const formLogin = document.getElementById('form-login');
            const formRegister = document.getElementById('form-register');

            tabLogin.addEventListener('click', () => {
                formLogin.classList.remove('hidden');
                formRegister.classList.add('hidden');
                tabLogin.classList.add('border-emerald-600', 'text-emerald-600');
                tabRegister.classList.remove('border-emerald-600', 'text-emerald-600');
            });

            tabRegister.addEventListener('click', () => {
                formLogin.classList.add('hidden');
                formRegister.classList.remove('hidden');
                tabRegister.classList.add('border-emerald-600', 'text-emerald-600');
                tabLogin.classList.remove('border-emerald-600', 'text-emerald-600');
            });
        }

        function setupForms() {
            document.getElementById('login-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const errorEl = document.getElementById('login-error');

                try {
                    errorEl.textContent = '';
                    await signInUser(email, password);
                    showModal("Başarılı", "Giriş yapıldı. Ana sayfaya yönlendiriliyorsunuz.");
                    setTimeout(() => { window.location.href = './index.html'; }, 1000);

                } catch (error) {
                    errorEl.textContent = "Giriş başarısız: Geçersiz e-posta veya şifre.";
                }
            });

            document.getElementById('register-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('register-name').value;
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const errorEl = document.getElementById('register-error');

                try {
                    errorEl.textContent = '';
                    await registerUser(name, email, password);
                    showModal("Başarılı", "Kayıt işlemi tamamlandı. Lütfen giriş yapın.");
                    document.getElementById('tab-login').click();

                } catch (error) {
                    let errMsg = "Kayıt başarısız oldu.";
                    if (error.message.includes('auth/weak-password')) errMsg = "Şifre en az 6 karakter olmalıdır.";
                    if (error.message.includes('auth/email-already-in-use')) errMsg = "Bu e-posta adresi zaten kullanılıyor.";
                    errorEl.textContent = errMsg;
                }
            });
        }
    </script>
</body>
</html>
